!function(a){var b,c=Backbone.View.extend({template:_.template(a("#compound-template").html()),className:"pi-widget js-source",events:{"click .pi-icon-cursor":"animateRemove"},render:function(){return this.$el.html(this.template(this.model)),this.el},animateRemove:function(){var a=this;this.$el.fadeOut(300,function(){i.addOne(a.model,"show"),a.remove()})}}),d=Backbone.View.extend({template:_.template(a("#profile-template").html()),className:"user-widget js-source",render:function(){return this.$el.html(this.template(this.model)).draggable({helper:"clone",revert:"invalid",connectToSortable:".user-widget-group .user-widget-body",start:function(b,c){c.helper.outerWidth(a(b.currentTarget).outerWidth())}}).attr("data-model",JSON.stringify(this.model)),this.el}}),e=Backbone.View.extend({template:_.template(a("#group-template").html()),className:"pi-widget user-widget-group-hide",events:{"click .js-remove-all":"animateRemove","click .js-toggle":"toggleShow","click .js-remove-one":"removeField","click .js-edit-title":"editTitle","keypress .user-group-input":"updateOnEnter","blur .user-group-input":"saveTitle"},defaultModel:{title:"",fields:[],compound:""},initialize:function(){this.model=a.extend({},this.defaultModel,this.model)},render:function(){var a=this.$el,b=this.model.compound;return a.html(this.template(this.model)).attr({"data-compound":b}),b?a.addClass("user-widget-compound"):a.addClass("user-widget-group"),this.sortable(),this.el},animateRemove:function(){var a=this,b=this.model;this.$el.fadeOut(300,function(){b.compound&&h.addOne(b),a.remove()})},toggleShow:function(){var a=this.$el;a.hasClass("user-widget-group-hide")?a.removeClass("user-widget-group-hide").find(".js-toggle").removeClass("icon-angle-down").addClass("icon-angle-up"):a.addClass("user-widget-group-hide").find(".js-toggle").removeClass("icon-angle-up").addClass("icon-angle-down")},removeField:function(b){var c=a(b.target).parent();g.addOne(c.data("model")),f(c)},sortable:function(){this.model;this.$(".user-widget-body").sortable({items:".user-widget",delay:100,receive:function(a,b){var c=b.item;c.fadeOut(300,function(){c.remove()})}})},editTitle:function(){this.$(".user-group-input").val(this.$(".user-group-title").html()).show().focus()},updateOnEnter:function(a){13==a.keyCode&&this.saveTitle()},saveTitle:function(){var b=this.$(".user-group-input"),c=a.trim(b.val());c&&this.$(".user-group-title").html(c),b.hide()}}),f=function(a,b){a.fadeOut(300,function(){a.remove(),b&&b()})},g={$el:a("#js-profile"),init:function(){this.render()},render:function(){for(var a=b.profile,c=0;c<a.length;c++)this.addOne(a[c])},addOne:function(a){this.$el.append(new d({model:a}).render())}},h={$el:a("#js-compound"),init:function(){this.render()},render:function(){for(var a=b.compounds,c=0;c<a.length;c++)this.addOne(a[c])},addOne:function(a){this.$el.append(new c({model:a}).render())}},i={$el:a("#js-groups"),$:function(a){return this.$el.find(a)},init:function(){this.$list=this.$(".user-widget-groups"),this.$form=this.$("form"),this.render(),this.bindEvents()},render:function(){for(var a=b.data,c=0;c<a.length;c++)this.addOne(a[c])},addOne:function(a,b){var c=new e({model:a});console.log(b),b&&c.toggleShow(),this.$list.append(c.render())},bindEvents:function(){var c=this;this.$form.submit(function(b){b.preventDefault();var c=i.$("[name=title]"),d=a.trim(c.val());c.val(""),d&&i.addOne({title:d},"show")}),this.$list.sortable({items:".pi-widget",handle:".pi-widget-header",start:function(a,b){b.placeholder.outerHeight(b.item.outerHeight())}}),this.$(".js-save").click(function(){var d=c.$list,e=[];d.find(".pi-widget").each(function(){var b={fields:[]},c=a(this);b.title=c.find(".user-group-title").html(),b.compound=c.attr("data-compound"),c.find(".user-widget").each(function(){b.fields.push(a(this).data("model"))}),e.push(b)}),a.post(b.urlSave,{data:e}).done(function(c){c=a.parseJSON(c),c.status?systemMessage.succ(b.successMsg):systemMessage.fail(b.failMsg)})})}};this.profileDressup=function(a){b=a,i.init(),g.init(),h.init()}}(jQuery);