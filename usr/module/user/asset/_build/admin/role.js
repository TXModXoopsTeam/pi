angular.module("userRoleModule").config(["$routeProvider","piProvider","config",function(a,b,c){function d(a){return c.assetRoot+a+".html"}a.when("/:role/users",{templateUrl:d("role-user"),controller:"UserCtrl",resolve:{data:["$q","$route","$rootScope","server",function(a,b,c,d){var e=a.defer(),f=b.current.params;return c.alert=2,d.getUserByRole(f).success(function(a){a.role=f.role,a.users=a.users||[],e.resolve(a),c.alert=""}),e.promise}]}}).otherwise({templateUrl:d("role-index"),controller:"RoleCtrl",resolve:{data:["$q","server",function(a,b){var c=a.defer();return b.get().success(function(a){c.resolve(a)}),c.promise}]}}),b.hashPrefix(),b.translations(c.t),b.ajaxSetup()}]).service("server",["$http","config",function(a,b){var c=b.urlRoot;this.get=function(){return a.get(c+"list")},this.getUserByRole=function(b){return a.get(c+"user",{params:{name:b.role,page:b.p}})},this.addUser=function(b,d){return a.post(c+"user",{name:b,field:d.field,user:d.data,op:"add"})},this.removeUser=function(b,d){return a.post(c+"user",{name:b,field:"uid",op:"remove",user:d})}}]).controller("RoleCtrl",["$scope","data",function(a,b){angular.extend(a,b)}]).controller("UserCtrl",["$scope","$location","data","server",function(a,b,c,d){angular.extend(a,c),a.entity={field:"uid"},a.$watch("paginator.page",function(a,c){a!=c&&b.search("p",a)}),a.removeAction=function(b){var c=a.users[b];d.removeUser(a.role,c.id).success(function(c){c.status&&a.users.splice(b,1)})},a.submit=function(){d.addUser(a.role,a.entity).success(function(b){var c=b.data;b.status&&(a.users.push(c),a.entity.data="")})}}]);