angular.module("userMaintenanceModule").config(["$routeProvider","piProvider","config",function(a,b,c){function d(a){return c.assetRoot+a+".html"}a.when("/stats",{templateUrl:d("maintenance-stats"),controller:"statsCtrl"}).when("/logs",{templateUrl:d("maintenance-logs"),controller:"logCtrl",resolve:{data:["$q","$route","$rootScope","server",function(a,b,d,e){var f=a.defer(),g=b.current.params;return d.alert=2,g.sort=g.sort||"time_activated",e.getLog(g).success(function(a){a.sort=g.sort,angular.forEach(a.users,function(a){a.editUrl=c.editUrlRoot+"index/uid/"+a.id}),f.resolve(a),d.alert=""}),f.promise}]}}).when("/deleted",{templateUrl:d("maintenance-deleted"),controller:"deletedCtrl",resolve:{data:["$q","$route","$rootScope","server",function(a,b,c,d){var e=a.defer();return c.alert=2,d.getDeleted(b.current.params).success(function(a){e.resolve(a),c.alert=""}),e.promise}]}}).when("/logs/:id",{templateUrl:d("maintenance-logs-detail"),controller:"logsDetailCtrl",resolve:{data:["$q","$route","$rootScope","server",function(a,b,d,e){var f=a.defer();return d.alert=2,e.getUserLogs(b.current.params.id).success(function(a){angular.forEach(a,function(b,d){b||(a[d]=c.t.NULL)}),f.resolve(a),d.alert=""}),f.promise}]}}).otherwise({redirectTo:"/stats"}),b.hashPrefix(),b.navTabs(c.navTabs),b.translations(c.t),b.ajaxSetup()}]).service("server",["$http","config",function(a,b){var c=b.urlRoot;this.getStats=function(){return a.get(c+"stats")},this.getLog=function(b){return a.get(c+"logList",{params:b})},this.getUserLogs=function(b){return a.get(c+"log",{params:{uid:b}})},this.getDeleted=function(b){return a.get(c+"deletedList",{params:b})},this.clear=function(b){return a.post(c+"clear",b)}}]).controller("statsCtrl",["$scope","server","config",function(a,b,c){b.getStats().success(function(b){var d=[];angular.forEach(b.ip,function(a,b){d.push({title:c.t[b.toUpperCase()],content:a})}),delete b.ip,a.tabs=d,angular.extend(a,b)})}]).controller("logCtrl",["$scope","$location","data","server",function(a,b,c){angular.extend(a,c),a.$watch("sort",function(a,c){a!==c&&b.search("sort",a)}),a.$watch("paginator.page",function(a,c){a!==c&&b.search("p",a)})}]).controller("deletedCtrl",["$scope","$location","data","server","config",function(a,b,c,d,e){angular.extend(a,c),a.$watch("paginator.page",function(a,c){a!==c&&b.search("p",a)}),a.$watch("allChecked",function(b){angular.forEach(a.users,function(a){a.checked=b})}),a.clearBatchAction=function(){var b=[],c=a.users;angular.forEach(c,function(a){a.checked&&b.push(a.id)}),b.length&&confirm(e.t.DELETE_BATCH)&&d.clear({uids:b.join(",")}).success(function(b){if(b.status){var d=[];angular.forEach(c,function(a){!a.checked&&d.push(a)}),a.users=d}})},a.clearAllAction=function(){a.users.length&&confirm(e.t.DELETE_ALL)&&d.clear({type:"all"}).success(function(b){b.status&&(a.users=[],a.paginator.count=0)})},a.clearAction=function(b){if(confirm(e.t.DELETE_ONE)){var c=a.users[b];d.clear({uids:c.id}).success(function(c){c.status&&a.users.splice(b,1)})}}}]).controller("logsDetailCtrl",["$scope","data",function(a,b){a.entity=b}]);